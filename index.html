<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíñ Descubra a Idade do Seu Amado Felino</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Tela Inicial -->
    <section id="welcome-screen" class="screen active">
        <div class="welcome-container">
            <div class="logo-section">
                <div class="logo-icon">üê±üíñ</div>
                <h1 class="main-title">Descubra a Idade do Seu Amado Felino</h1>
                <p class="subtitle">Um quiz personalizado que revela quantos anos humanos tem seu companheiro de quatro patas</p>
            </div>
            
            <div class="features-preview">
                <div class="feature-item">
                    <span class="feature-icon">‚ú®</span>
                    <span class="feature-text">An√°lise personalizada</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">üî¨</span>
                    <span class="feature-text">Baseado em ci√™ncia</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">‚ù§Ô∏è</span>
                    <span class="feature-text">Feito com amor</span>
                </div>
            </div>
            
            <button class="btn btn--primary btn--lg btn--full-width" onclick="startQuiz()">
                Come√ßar a Jornada üêæ
            </button>
        </div>
    </section>

    <!-- Quiz -->
    <section id="quiz-screen" class="screen">
        <div class="container">
            <div class="quiz-header">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="quiz-progress"></div>
                    </div>
                    <span class="progress-text" id="progress-text">Pergunta 1 de 12</span>
                </div>
            </div>

            <div class="quiz-content">
                <div class="question-card" id="question-card">
                    <div class="question-icon" id="question-icon">üê±</div>
                    <h2 class="question-title" id="question-title">Qual √© o nome do seu precioso gatinho?</h2>
                    <div class="question-options" id="question-options">
                        <input type="text" class="form-control" id="cat-name-input" placeholder="Digite o nome do seu felino...">
                    </div>
                    <button class="btn btn--primary btn--lg" id="next-btn" onclick="nextQuestion()">
                        Pr√≥xima Pergunta üíï
                    </button>
                </div>
            </div>
        </div>
    </section>

  <script>
/* ====== CONFIGURA√á√ÉO ====== */
const CHECKOUT_URL = 'https://seguro.paipet.com.br/r/NIC3723OUB';

/* Substitui a fun√ß√£o processPayment para:
   - salvar o resultado/localmente,
   - redirecionar para o checkout,
   - N√ÉO liberar o resultado imediatamente. */
function processPayment(method) {
  // salva m√©todo escolhido (opcional)
  try { localStorage.setItem('paymentMethod', method); } catch (e) {}

  // tenta obter o resultado do quiz (prioriza window.testResult, sen√£o l√™ do DOM)
  let result = null;
  if (typeof window.testResult !== 'undefined') {
    result = window.testResult;
  } else {
    result = {
      title: document.getElementById('result-title')?.innerText || '',
      age: document.getElementById('result-age')?.innerText || '',
      lifeStage: document.getElementById('life-stage-content')?.innerText || '',
      characteristics: document.getElementById('characteristics-content')?.innerText || '',
      care: document.getElementById('care-content')?.innerText || '',
      expectancy: document.getElementById('expectancy-content')?.innerText || '',
      emotional: document.getElementById('emotional-content')?.innerText || ''
    };
  }

  // salva no localStorage para restaurar ap√≥s retorno do checkout
  try { localStorage.setItem('quizResult', JSON.stringify(result)); } catch (e) {}

  // mostra a tela de processamento localmente (opcional, melhora UX)
  document.getElementById('payment-screen')?.style.setProperty('display','none');
  document.getElementById('processing-screen')?.style.setProperty('display','block');

  // constr√≥i return URL ‚Äî a PaiPet deve redirecionar para essa URL ap√≥s aprova√ß√£o
  const returnUrl = window.location.origin + window.location.pathname + '?status=aprovado';

  // redireciona para o checkout (se a PaiPet aceitar return_url ela usar√°; caso contr√°rio, configure redirecionamento no painel)
  window.location.href = CHECKOUT_URL + '?return_url=' + encodeURIComponent(returnUrl);
}

/* Ao carregar a p√°gina, s√≥ se houver ?status=aprovado mostramos o resultado.
   Isso evita que o clique nos bot√µes abra o resultado sem passar pelo checkout. */
window.addEventListener('load', function () {
  const params = new URLSearchParams(window.location.search);
  if (params.get('status') === 'aprovado') {
    // recupera resultado salvo localmente
    let saved = null;
    try { saved = JSON.parse(localStorage.getItem('quizResult') || 'null'); } catch (e) { saved = null; }

    if (saved) {
      // preenche DOM com os dados recuperados
      if (saved.title) document.getElementById('result-title') && (document.getElementById('result-title').innerText = saved.title);
      if (saved.age) document.getElementById('result-age') && (document.getElementById('result-age').innerText = saved.age);
      if (saved.lifeStage) document.getElementById('life-stage-content') && (document.getElementById('life-stage-content').innerText = saved.lifeStage);
      if (saved.characteristics) document.getElementById('characteristics-content') && (document.getElementById('characteristics-content').innerText = saved.characteristics);
      if (saved.care) document.getElementById('care-content') && (document.getElementById('care-content').innerText = saved.care);
      if (saved.expectancy) document.getElementById('expectancy-content') && (document.getElementById('expectancy-content').innerText = saved.expectancy);
      if (saved.emotional) document.getElementById('emotional-content') && (document.getElementById('emotional-content').innerText = saved.emotional);

      // transi√ß√£o de telas: esconde pagamento/processing e mostra resultado
      document.getElementById('payment-screen')?.style.setProperty('display','none');
      document.getElementById('processing-screen')?.style.setProperty('display','none');
      document.getElementById('result-screen')?.style.setProperty('display','block');

      // limpa query string para evitar re-execu√ß√£o acidental se o usu√°rio atualizar a p√°gina
      history.replaceState(null, '', window.location.pathname);
      // opcional: remover o resultado do storage
      // localStorage.removeItem('quizResult');
    } else {
      alert('Pagamento aprovado, mas n√£o foi encontrado o resultado salvo do teste.');
    }
  } else {
    // se n√£o veio com status=aprovado, garante que a tela de resultado esteja oculta
    // (evita que outra l√≥gica apare√ßa por engano)
    // Voc√™ pode ajustar essas linhas conforme seu CSS/controle de telas
    document.getElementById('processing-screen')?.style.setProperty('display','none');
    // geralmente a tela de pagamento deve estar vis√≠vel por padr√£o
  }
});
</script>
